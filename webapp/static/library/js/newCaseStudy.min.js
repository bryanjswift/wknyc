wknyc.cms.newCaseStudy.CaseStudyCapsule=new Class({Implements:Options,options:{isRequired:false,cloneMarkup:false},canvas:null,hasExpanded:false,initialize:function(b,a){this.setOptions(a);if(this.options.cloneMarkup){this.canvas=b.clone()}else{this.canvas=b}this.setupAssets()},setupAssets:function(){if(!this.options.isRequired){var f=new wknyc.common.gui.InputField(this.canvas.getElement(".order input"),{prefillElement:null});var d=new wknyc.common.gui.SpinBox(this.canvas.getElement(".order input"),{minValue:1,maxValue:10})}var b=new wknyc.common.gui.InputField(this.canvas.getElements(".title input")[0],{prefillElement:"label.prefill"});var e=new wknyc.common.gui.InputField(this.canvas.getElements(".title input")[1],{prefillElement:"label.prefill"});var c;this.canvas.getElements(".launchDate input").each(function(g){c=new wknyc.common.gui.InputField(g,{prefillElement:"label.prefill"})});var a=this.canvas.getElements("a.expand-collapse");a.each(function(g){g.addEvent("click",function(h){this.expandCollapseToggle($(h.target));return false}.bind(this))}.bind(this))},expandCollapseToggle:function(a){if(a.hasClass("open")){this.canvas.getElements("a.expand-collapse").each(function(b){b.removeClass("open")});this.canvas.getElement(".content").addClass("hide")}else{this.canvas.getElements("a.expand-collapse").each(function(b){b.addClass("open")});this.canvas.getElement(".content").removeClass("hide");if(!this.hasExpaned){this.setupExpandedContent()}}},setupExpandedContent:function(){this.hasExpanded=true;var a=new wknyc.common.gui.SkinnedFileInput($("select_video"),{skinnedElement:$("select_video").getNext("a.plus"),reuploadText:"select new video"})},inject:function(b,a){this.canvas.inject(b,a)}});wknyc.cms.newCaseStudy.HelpPopup=new Class({Implements:Options,options:{focusBlurTarget:null,titleTagTarget:null},element:$empty,wrapper:$empty,focusBlurTarget:null,titleTagTarget:null,popup:$empty,initialize:function(b,a){this.setOptions(a);this.element=$(b);this.focusBlurTarget=$(this.options.focusBlurTarget);this.titleTagTarget=$(this.options.titleTagTarget);if(!this.options.titleTagTarget){this.titleTagTarget=this.element}this.setupAssets();this.hide(true)},setupAssets:function(){this.wrapper=new Element("div").addClass("popup-wrapper").wraps(this.element);this.popup=new Element("div").addClass("popup").inject(this.wrapper);var a=new Element("div").inject(this.popup).appendText(this.titleTagTarget.get("title"));this.popup.set("tween",{duration:200,transition:new Fx.Transition(Fx.Transitions.Quad.easeOut)});this.element.erase("title");if(this.focusBlurTarget){this.focusBlurTarget.addEvent("focus",function(){this.show()}.bind(this));this.focusBlurTarget.addEvent("blur",function(){this.hide()}.bind(this))}},show:function(a){if(a){this.popup.fade("show")}else{this.popup.fade("in")}},hide:function(a){if(a){this.popup.fade("hide")}else{this.popup.fade("out")}},destroy:function(){wknyc.cms.newCaseStudy.HelpPopup.Unwrap(this.element);this.popup.erase("tween");if(this.focusBlurTarget){this.focusBlurTarget.removeEvents()}this.element=null;this.wrapper=null;this.focusBlurTarget=null;this.titleTagTarget=null;this.popup=null}});wknyc.cms.newCaseStudy.HelpPopup.Unwrap=function(a){var b=a.getParent(".popup-wrapper");if(!b){return}a.inject(b,"before");b.dispose()};wknyc.cms.newCaseStudy.PressCapsule=new Class({Implements:Options,options:{isRequired:false,cloneMarkup:false},canvas:null,hasExpanded:false,isEmpty:null,isNumeralsOnly:null,isMinLength:null,initialize:function(b,a){this.setOptions(a);if(this.options.cloneMarkup){this.canvas=b.clone()}else{this.canvas=b}this.setupAssets()},setupAssets:function(){var b=new wknyc.common.gui.InputField(this.canvas.getElement(".itemName input"),{prefillElement:null});var d;this.canvas.getElements(".pressDate input[type=text]:not(.dateValue)").each(function(f){d=new wknyc.common.gui.InputField(f,{prefillElement:"label.prefill"})});var a=new wknyc.common.gui.InputField(this.canvas.getElement(".pressUrl input"),{prefillElement:"label.prefill"});var c=new wknyc.common.gui.InputField(this.canvas.getElement(".pressSource input"),{prefillElement:null});var e=new wknyc.common.gui.InputField(this.canvas.getElement(".pressByline input"),{prefillElement:null})},inject:function(b,a){this.canvas.inject(b,a)}});wknyc.cms.newCaseStudy.BasicCaseStudyTab=new Class({canvas:$empty,form:$empty,validator:null,initialize:function(a){this.canvas=a;this.setupAssets();this.setupValidation()},setupAssets:function(){this.form=this.canvas.getElement("form")},setupValidation:function(){this.validator=new Form.Validator(this.form);this.validator.setOptions({onFormValidate:function(c,b,a){},onElementFail:function(c,d){console.log("PARENT");var a;d.each(function(f,e){a=c.get("validator").getValidator(f).getError(c)});c.set("title",a);wknyc.cms.newCaseStudy.HelpPopup.Unwrap(c);var b=new wknyc.cms.newCaseStudy.HelpPopup(c);b.show()},onElementPass:function(a){}})},submit:function(){this.form.getElement("input[type=submit]").click()},destroy:function(){this.canvas=null;this.form=null;this.validator.setOptions({onFormValidate:null,onElementFail:null,onElementPass:null});this.validator=null}});wknyc.cms.newCaseStudy.AssetsTab=new Class({Extends:wknyc.cms.newCaseStudy.BasicCaseStudyTab,initialize:function(a){this.parent(a)},setupAssets:function(){this.parent();var b;this.form.getElements("fieldset.capsule").each(function(d,c){b=new wknyc.cms.newCaseStudy.CaseStudyCapsule(d,{isRequired:d.hasClass("required")})});var a=$("add_more_assets").addEvent("click",function(c){var d=new wknyc.cms.newCaseStudy.CaseStudyCapsule($$(".templates fieldset.capsule:not(.required)")[0],{cloneMarkup:true});d.inject(this.form);return false})}});wknyc.cms.newCaseStudy.BasicInfoTab=new Class({Extends:wknyc.cms.newCaseStudy.BasicCaseStudyTab,initialize:function(a){this.parent(a)},setupAssets:function(){this.parent();var o=new wknyc.common.gui.InputField($("nameField"),{prefillElement:null});var i=new wknyc.cms.newCaseStudy.HelpPopup($("nameField"),{focusBlurTarget:"nameField"});var f=new wknyc.common.gui.InputField($("shortDescField"),{prefillElement:null});var n=new wknyc.cms.newCaseStudy.HelpPopup($("shortDescField"),{focusBlurTarget:"shortDescField"});var b=new wknyc.common.gui.InputField($("longDescField"),{prefillElement:null});var j=new wknyc.cms.newCaseStudy.HelpPopup($("longDescField"),{focusBlurTarget:"longDescField"});var p=new wknyc.common.gui.InputField($("launchDateMonth"));var l=new wknyc.cms.newCaseStudy.HelpPopup($("launchDateMonth").getParent(),{focusBlurTarget:"launchDateMonth",titleTagTarget:"launchDateMonth"});var e=new wknyc.common.gui.InputField($("launchDateYear"));var d=new wknyc.cms.newCaseStudy.HelpPopup($("launchDateYear").getParent(),{focusBlurTarget:"launchDateYear",titleTagTarget:"launchDateYear"});var m=new wknyc.cms.newCaseStudy.HelpPopup($("clientSelect"),{focusBlurTarget:"clientSelect"});var k=new wknyc.common.gui.InputField($("orderpicker"),{prefillElement:null});var c=new wknyc.common.gui.SpinBox($("orderpicker"),{minValue:1,maxValue:10});var a=new wknyc.cms.newCaseStudy.HelpPopup($("orderpicker"),{focusBlurTarget:"orderpicker"});var h=new wknyc.common.gui.SkinnedFileInput($("select_PDF"),{skinnedElement:$("select_PDF").getNext("a.file_upload"),reuploadText:"select new PDF"});var g=new wknyc.common.gui.DraggableToggle($("displayOnSiteRadio-on"),$("displayOnSiteRadio-off"))}});wknyc.cms.newCaseStudy.PressTab=new Class({Extends:wknyc.cms.newCaseStudy.BasicCaseStudyTab,capsules:[],initialize:function(a){this.parent(a)},setupAssets:function(){this.parent();var b;this.form.getElements("fieldset.capsule").each(function(d,c){b=new wknyc.cms.newCaseStudy.PressCapsule(d,{isRequired:d.hasClass("required")});this.capsules.push(b)}.bind(this));var a=$("add_more_press").addEvent("click",function(c){var d=new wknyc.cms.newCaseStudy.PressCapsule($$(".templates fieldset.capsule")[0],{cloneMarkup:true});d.inject(this.form);return false})},setupValidation:function(){this.validator=new Form.Validator(this.form);this.validator.ignoreField(this.canvas.getElement(".pressDate .pressDateDay"));this.validator.ignoreField(this.canvas.getElement(".pressDate .pressDateMonth"));this.validator.ignoreField(this.canvas.getElement(".pressDate .pressDateYear"));this.validator.setOptions({onFormValidate:function(c,b,a){},onElementFail:function(c,d){var a;d.each(function(f,e){a=c.get("validator").getValidator(f).getError(c)});c.set("title",a);wknyc.cms.newCaseStudy.HelpPopup.Unwrap(c);var b=new wknyc.cms.newCaseStudy.HelpPopup(c);b.show()},onElementPass:function(a){wknyc.cms.newCaseStudy.HelpPopup.Unwrap(a)}})},getDateFromFields:function(){var c=this.canvas.getElement(".pressDate .pressDateMonth").get("value")!=""?this.canvas.getElement(".pressDate .pressDateMonth").get("value").toInt():"";var a=this.canvas.getElement(".pressDate .pressDateDay").get("value")!=""?this.canvas.getElement(".pressDate .pressDateDay").get("value").toInt():"";var b=this.canvas.getElement(".pressDate .pressDateYear").get("value")!=""?this.canvas.getElement(".pressDate .pressDateYear").get("value").toInt():"";if(c+a+b==""){return""}else{return c+"/"+a+"/"+b}},submit:function(){this.canvas.getElement(".pressDate .dateValue").set({value:this.getDateFromFields()});console.log(this.canvas.getElement(".pressDate .dateValue"));console.log(this.canvas.getElement(".pressDate .dateValue").get("value"));this.parent()}});wknyc.cms.newCaseStudy.NewCaseStudy=new Class({sectionTabs:null,tabs:null,tabLoadedCallback:null,currentTab:null,initialize:function(){this.setupAssets()},setupAssets:function(){this.sectionTabs=new wknyc.common.gui.SectionTabs($("sectionTabs"),$("newCaseStudyContent").getElement(".contentBody"),{activeClass:"on"}).addEvent("change",function(){console.log("Tab Change")}.bind(this));this.tabs=new wknyc.common.gui.Tabs($("steps_tabs"),$("steps_content"),{useAjax:true,useDeepLinking:true}).addEvent("change",this.onTabChange.bind(this));this.tabnav=new wknyc.common.gui.Tabs($("steps_nav").getElement("ol"),$("steps_content"),{useAjax:true,loadDefaultTab:false}).addEvent("change",this.onTabNav.bind(this));var b=$("steps_nav").getElement("a.save").addEvent("click",function(c){this.onSaveDraft();return false}.bind(this));var a=$("steps_nav").getElement("a.submit").addEvent("click",function(c){this.onFinish();return false}.bind(this))},onTabChange:function(b,a){this.tabLoadedCallback.call();this.updateNav()},onSaveDraft:function(){this.currentTab.submit()},onFinish:function(){this.currentTab.submit()},setTabLoadedCallback:function(a){this.tabLoadedCallback=a.bind(this)},onTabNav:function(b,a){this.tabs.selectTabByIndex(b)},updateNav:function(){$("steps_nav").getElements("ol li:not(.hide)").each(function(d,c){d.addClass("hide")});var b=this.tabs.currentIndex-1;var a=this.tabs.currentIndex+1;if(b>=0){$("steps_nav").getElements("ol li")[b].removeClass("hide")}if(a<$("steps_nav").getElements("ol li").length){$("steps_nav").getElements("ol li")[a].removeClass("hide")}},setupBasicInfoSection:function(){if(this.currentTab){this.currentTab.destroy()}this.currentTab=new wknyc.cms.newCaseStudy.BasicInfoTab($("basicinfo_content"))},setupAssetsSection:function(){if(this.currentTab){this.currentTab.destroy()}this.currentTab=new wknyc.cms.newCaseStudy.AssetsTab($("assets_content"))},setupPressSection:function(){if(this.currentTab){this.currentTab.destroy()}this.currentTab=new wknyc.cms.newCaseStudy.PressTab($("press_content"))}});