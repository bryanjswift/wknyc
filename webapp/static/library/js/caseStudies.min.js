wknyc.cms.caseStudies.CaseStudies=new Class({sectionTabs:{},cases:{},clients:{},curSection:"allCaseSection",initialize:function(){this.sectionTabs=new wknyc.common.gui.SectionTabs($("sectionTabs"),{callback:function(a){this.curSection=a;if(a=="awardsSection"){this.showAwardEntries()}else{this.showCaseStudies()}}.bind(this)});this.sectionTabs.showOnState(this.curSection,true);this.getPageData()},getPageData:function(){var a=new Request({url:wknyc.swf.src.xml,onComplete:function(b){wknyc.json=new MooTools.Utilities.XmlParser(b).json();this.refresh()}.bind(this)}).send()},refresh:function(){this.cases=wknyc.json.work.workcase;this.clients=wknyc.json.work.clients.client.reverse();this.cases=this.cases.reverse();this.buildSidebar();this.showCaseStudies()},buildSidebar:function(){var e=new wknyc.cms.caseStudies.FiltersData(this.cases);var f=new wknyc.common.gui.InputField($("caseFilter"));var b=new wknyc.common.gui.MenuItem($("clientFilter").getElement("ul"),{itemCallback:this.onFiltersUpdated.bind(this),multiSelect:true,allOption:"All"});b.setData(e.getAllClients());var d=new Slider($("updated_minmax_slider"),$("updated_slider_minmax_minKnobA"),$("updated_slider_bkg_img"),{start:0,end:e.getUpdatedDates().length-1,snap:false,offset:9,onChange:function(h){$("updated_slider_minmax_min").set("html",e.getUpdatedDateByIndex(Math.max(h.minpos,0)));$("updated_slider_minmax_max").set("html",e.getUpdatedDateByIndex(h.maxpos))}},$("updated_slider_minmax_maxKnobA"));$("updated_slider_minmax_minKnobA").addEvent("mouseup",this.onFiltersUpdated.bind(this));$("updated_slider_minmax_maxKnobA").addEvent("mouseup",this.onFiltersUpdated.bind(this));var a=new Slider($("published_minmax_slider"),$("published_slider_minmax_minKnobA"),$("published_slider_bkg_img"),{start:0,end:e.getPublishedDates().length-1,snap:false,offset:9,onChange:function(h){$("published_slider_minmax_min").set("html",e.getPublishedDateByIndex(Math.max(h.minpos,0)));$("published_slider_minmax_max").set("html",e.getPublishedDateByIndex(h.maxpos))}},$("published_slider_minmax_maxKnobA"));$("published_slider_minmax_minKnobA").addEvent("mouseup",this.onFiltersUpdated.bind(this));$("published_slider_minmax_maxKnobA").addEvent("mouseup",this.onFiltersUpdated.bind(this));var c=$("statusFilter").getElement("ul");var g;e.getStatuses(function(h,i,j){g=new Element("li").appendText(h)});var g=new wknyc.common.gui.MenuItem($("statusFilter").getElement("ul"),{itemCallback:this.onFiltersUpdated.bind(this),multiSelect:true,allOption:"All"});g.setData(e.getStatuses())},onFiltersUpdated:function(){this.refreshTableRows()},refreshTableRows:function(){$("allCaseStudiesTable").getElements("tbody tr").fade("hide");$("allCaseStudiesTable").getElements("tbody tr").each(function(b,a){(function(){b.fade("show")}).delay(20*(a+6))},this)},showCaseStudies:function(){if($$("#allCaseStudiesTable tbody tr").length>0){$("allCaseContent").fade("in");$("awardsContent").fade("out")}else{this.buildCaseStudies()}},buildCaseStudies:function(){var b=$("allCaseStudiesTable");var d,e,c;this.cases.each(function(g,f,h){c=new wknyc.cms.caseStudies.CaseStudyData(g,g.gallery.media[f]);d=new Element("tr");b.getElement("tbody").grab(d);e=new Element("td",{html:'<span class="order">'+(f+1)+'</span><img src="'+c.getThumbnail("tiny")+'"/>'}).inject(d);e=new Element("td",{html:'<a href="#">'+c.getTitle()+"</a>","class":"name"});e.appendText(c.getDescription()).inject(d);e=new Element("td");e.appendText(c.getClient()).inject(d);e=new Element("td");e.appendText(c.getPublishedDate()).inject(d);e=new Element("td");e.appendText(c.getPublishedDate()).inject(d);e=new Element("td");e.appendText(c.getStatus()).inject(d)});var a=new SortingTable("allCaseStudiesTable",{zebra:false,defaultSort:"thead th:first-child",onSorted:function(){this.refreshTableRows()}.bind(this)})},showAwardEntries:function(){$("allCaseContent").fade("out");$("awardsContent").fade("in")},buildAwardEntries:function(){}});wknyc.cms.caseStudies.NewCaseStudy=new Class({tabs:null,tabLoadedCallback:null,initialize:function(){this.setupAssets()},setupAssets:function(){this.tabs=new wknyc.common.gui.Tabs($("steps_tabs"),$("steps_content"),{useAjax:true,defaultTab:1}).addEvent("change",this.onTabChange.bind(this));this.tabnav=new wknyc.common.gui.Tabs($("steps_nav").getElement("ol"),$("steps_content"),{useAjax:true,loadDefaultTab:false}).addEvent("change",this.onTabNav.bind(this))},onTabChange:function(b,a){this.tabLoadedCallback.call();this.updateNav()},setTabLoadedCallback:function(a){this.tabLoadedCallback=a},onTabNav:function(b,a){this.tabs.selectTabByIndex(b)},updateNav:function(){$("steps_nav").getElements("ol li:not(.hide)").each(function(d,c){d.addClass("hide")});var b=this.tabs.currentIndex-1;var a=this.tabs.currentIndex+1;if(b>=0){$("steps_nav").getElements("ol li")[b].removeClass("hide")}if(a<$("steps_nav").getElements("ol li").length){$("steps_nav").getElements("ol li")[a].removeClass("hide")}},setupBasicInfoSection:function(){var a=new wknyc.cms.caseStudies.BasicInfoTab($("basic_info"))},setupAssetsSection:function(){var a=new wknyc.cms.caseStudies.AssetsTab($("assets"))},setupCreditsSection:function(){console.log("Credits")},setupPressSection:function(){console.log("Press")},setupAwardsSection:function(){console.log("Awards")}});wknyc.cms.caseStudies.CaseStudyData=new Class({data:{},media:{},mediaPath:"/",thumbFull:null,thumbLarge:null,thumbMedium:null,thumbSmall:null,thumbTiny:null,id:null,title:null,description:null,client:null,published:null,updated:null,status:null,initialize:function(a,b){this.data=a;this.media=b;this.parseData()},parseData:function(){if(this.media){this.thumbFull=this.media.images.image[0].attributes.src;this.thumbLarge=this.media.images.image[1].attributes.src;this.thumbMedium=this.media.images.image[2].attributes.src;this.thumbSmall=this.media.images.image[3].attributes.src;this.thumbTiny=this.media.images.image[4].attributes.src}if(this.data){this.id=this.data.id;this.title=this.data.title;this.description=this.data.description;this.client=this.data.client;this.published=this.data.month+"/"+this.data.year;this.updated=this.published;this.status="Unknown"}this.mediaPath=_workRoot+this.id+"/images/";wknyc.utils.log(this.data)},getThumbnail:function(b){var a;switch(b){case"full":a=this.thumbFull;break;case"large":a=this.thumbLarge;break;case"medium":a=this.thumbMedium;break;case"small":a=this.thumbSmall;break;case"tiny":a=this.thumbTiny;break;default:a=this.thumbLarge}return this.mediaPath+a},getTitle:function(){return this.title},getDescription:function(){return this.description},getClient:function(){return this.client},getPublishedDate:function(){return this.published},getUpdatedDate:function(){return this.updated},getStatus:function(){return this.status}});wknyc.cms.caseStudies.FiltersData=new Class({clients:[],updatedDates:[],publishedDates:[],statuses:{},initialize:function(a){this.clients=wknyc.json.work.clients.client.reverse();this.updatedDates=["1 hour ago","1 day ago","1 week ago","1 year ago","all time"];this.publishedDates=["1 hour ago","1 day ago","1 week ago","1 year ago","5 years ago"];this.statuses=new Hash({copy:"Copywriting Needed",art:"Art Direction Needed",curation:"Master Curation Needed",copy_finished:"Copywriting Finished",art_finished:"Art Direction Finished",curation_finished:"Master Curation Finished",draft:"Locked Draft"})},getAllClients:function(a){if(a){this.clients.each(function(c,b,d){a.pass([this.getClientByIndex(b),b,d]).call()}.bind(this))}return this.clients},getClientByIndex:function(a){return this.clients[a].value},getUpdatedDates:function(a){if(a){this.updatedDates.each(function(c,b,d){a.pass([this.getUpdatedDateByIndex(b),b,this.updatedDates]).call()}.bind(this))}return this.updatedDates},getUpdatedDateByIndex:function(a){return this.updatedDates[a]},getPublishedDates:function(a){if(a){this.publishedDates.each(function(c,b,d){a.pass([this.getPublishedDateByIndex(b),b,this.publishedDates]).call()}.bind(this))}return this.publishedDates},getPublishedDateByIndex:function(a){return this.publishedDates[a]},getStatuses:function(a){if(a){this.statuses.each(function(b,c,d){a.pass([b,c,d]).call()})}return this.statuses},getStatusByKey:function(a){statuses.get(a)}});wknyc.cms.caseStudies.AssetsTab=new Class({Implements:Options,options:{},canvas:$empty,initialize:function(b,a){this.canvas=b;this.setupAssets()},setupAssets:function(){var c=this.canvas.getElement("#assetsForm");var b;c.getElements("fieldset.capsule").each(function(e,d){b=new wknyc.cms.caseStudies.CaseStudyCapsule(e,{isRequired:e.hasClass("required")})});var a=$("add_more_assets").addEvent("click",function(d){var f=new wknyc.cms.caseStudies.CaseStudyCapsule($$(".templates fieldset.capsule:not(.required)")[0],{cloneMarkup:true});f.inject(c);return false})}});wknyc.cms.caseStudies.BasicInfoTab=new Class({Implements:Options,options:{},canvas:$empty,initialize:function(a){this.canvas=a;this.setupAssets()},setupAssets:function(){var o=new wknyc.common.gui.InputField($("nameField"),{prefillElement:null});var i=new wknyc.cms.caseStudies.HelpPopup($("nameField"),{focusBlurTarget:"nameField"});var f=new wknyc.common.gui.InputField($("shortDescField"),{prefillElement:null});var n=new wknyc.cms.caseStudies.HelpPopup($("shortDescField"),{focusBlurTarget:"shortDescField"});var b=new wknyc.common.gui.InputField($("longDescField"),{prefillElement:null});var j=new wknyc.cms.caseStudies.HelpPopup($("longDescField"),{focusBlurTarget:"longDescField"});var p=new wknyc.common.gui.InputField($("launchDateMonth"));var l=new wknyc.cms.caseStudies.HelpPopup($("launchDateMonth").getParent(),{focusBlurTarget:"launchDateMonth",titleTagTarget:"launchDateMonth"});var e=new wknyc.common.gui.InputField($("launchDateYear"));var d=new wknyc.cms.caseStudies.HelpPopup($("launchDateYear").getParent(),{focusBlurTarget:"launchDateYear",titleTagTarget:"launchDateYear"});var m=new wknyc.cms.caseStudies.HelpPopup($("clientSelect"),{focusBlurTarget:"clientSelect"});var k=new wknyc.common.gui.InputField($("orderpicker"),{prefillElement:null});var c=new wknyc.common.gui.SpinBox($("orderpicker"),{minValue:1,maxValue:10});var a=new wknyc.cms.caseStudies.HelpPopup($("orderpicker"),{focusBlurTarget:"orderpicker"});var h=new wknyc.common.gui.SkinnedFileInput($("select_PDF"),{skinnedElement:$("select_PDF").getNext("a.file_upload"),reuploadText:"select new PDF"});var g=new wknyc.common.gui.DraggableToggle($("displayOnSiteRadio-on"),$("displayOnSiteRadio-off"))}});wknyc.cms.caseStudies.PressTab=new Class({Implements:Options,options:{},initialize:function(a,b){}});wknyc.cms.caseStudies.CaseStudyCapsule=new Class({Implements:Options,options:{isRequired:false,cloneMarkup:false},canvas:null,hasExpanded:false,initialize:function(b,a){this.setOptions(a);if(this.options.cloneMarkup){this.canvas=b.clone()}else{this.canvas=b}this.setupAssets()},setupAssets:function(){if(!this.options.isRequired){var f=new wknyc.common.gui.InputField(this.canvas.getElement(".order input"),{prefillElement:null});var d=new wknyc.common.gui.SpinBox(this.canvas.getElement(".order input"),{minValue:1,maxValue:10})}var b=new wknyc.common.gui.InputField(this.canvas.getElements(".title input")[0],{prefillElement:"label.prefill"});var e=new wknyc.common.gui.InputField(this.canvas.getElements(".title input")[1],{prefillElement:"label.prefill"});var c;this.canvas.getElements(".launchDate input").each(function(g){c=new wknyc.common.gui.InputField(g,{prefillElement:"label.prefill"})});var a=this.canvas.getElements("a.expand-collapse");a.each(function(g){g.addEvent("click",function(h){this.expandCollapseToggle($(h.target));return false}.bind(this))}.bind(this))},expandCollapseToggle:function(a){if(a.hasClass("open")){this.canvas.getElements("a.expand-collapse").each(function(b){b.removeClass("open")});this.canvas.getElement(".content").addClass("hide")}else{this.canvas.getElements("a.expand-collapse").each(function(b){b.addClass("open")});this.canvas.getElement(".content").removeClass("hide");if(!this.hasExpaned){this.setupExpandedContent()}}},setupExpandedContent:function(){this.hasExpanded=true;var a=new wknyc.common.gui.SkinnedFileInput($("select_video"),{skinnedElement:$("select_video").getNext("a.plus"),reuploadText:"select new video"})},inject:function(b,a){this.canvas.inject(b,a)}});wknyc.cms.caseStudies.HelpPopup=new Class({Implements:Options,options:{focusBlurTarget:null,titleTagTarget:null},element:$empty,focusBlurTarget:null,popup:$empty,initialize:function(b,a){this.setOptions(a);this.element=$(b);this.focusBlurTarget=$(this.options.focusBlurTarget);this.titleTagTarget=$(this.options.titleTagTarget);if(!this.options.titleTagTarget){this.titleTagTarget=this.element}this.setupAssets();this.hide(true)},setupAssets:function(){var a=new Element("div").addClass("popup-wrapper").wraps(this.element);this.popup=new Element("div").addClass("popup").inject(a).appendText(this.titleTagTarget.get("title"));this.popup.set("tween",{duration:200,transition:new Fx.Transition(Fx.Transitions.Quad.easeOut)});this.element.erase("title");if(this.focusBlurTarget){this.focusBlurTarget.addEvent("focus",function(){this.show()}.bind(this));this.focusBlurTarget.addEvent("blur",function(){this.hide()}.bind(this))}},show:function(a){if(a){this.popup.fade("show")}else{this.popup.fade("in")}},hide:function(a){if(a){this.popup.fade("hide")}else{this.popup.fade("out")}}});