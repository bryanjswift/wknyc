wknyc.common.gui.DraggableToggle=new Class({Implements:Options,options:{},onElement:$empty,onButton:$empty,offElement:$empty,offButton:$empty,handle:$empty,frame:$empty,onState:true,leftLimit:0,rightLimit:0,initialize:function(a,b){this.onElement=a.addClass("hide");this.offElement=b.addClass("hide");this.draw();this.getStartState();this.addEvents()},draw:function(){var b=new Element("div").addClass("dragtoggle-wrapper");b.wraps(this.onElement).grab(this.offElement);this.onButton=new Element("a").set("href","#").appendText("On").addClass("on").inject(b);this.offButton=new Element("a").set("href","#").appendText("Off").addClass("off").inject(b);this.frame=new Element("div").addClass("frame").inject(b);this.handle=new Element("div").addClass("handle").inject(b).set("tween",{duration:200,transition:new Fx.Transition(Fx.Transitions.Quint.easeOut)});this.leftLimit=-this.onButton.getStyle("width").toInt();this.rightLimit=0;var a=new Drag(this.handle,{handle:this.frame,limit:{x:[this.leftLimit,this.rightLimit],y:[0,0],},onComplete:function(d,e){var c=d.getStyle("left").toInt();if(c<this.leftLimit/2){this.setToggleState(false)}else{this.setToggleState(true)}}.bind(this)})},getStartState:function(){if(this.offElement.get("checked")){this.setToggleState(false,true)}else{this.setToggleState(true,true)}},addEvents:function(){this.onButton.addEvent("click",function(a){this.setToggleState(false);return false}.bind(this));this.offButton.addEvent("click",function(a){this.setToggleState(true);return false}.bind(this))},setToggleState:function(b,a){this.onState=b;if(b){if(a){this.handle.set("styles",{left:"0"})}else{this.handle.tween("left","0")}this.offButton.addClass("hide");this.onButton.removeClass("hide");this.onElement.set("checked","checked");this.offElement.erase("checked")}else{if(a){this.handle.set("styles",{left:this.leftLimit})}else{this.handle.tween("left",this.leftLimit)}this.onButton.addClass("hide");this.offButton.removeClass("hide");this.offElement.set("checked","checked");this.onElement.erase("checked")}},toggleState:function(){this.toggleState(!this.onState)}});wknyc.common.gui.DropDown=new Class({Implements:Options,options:{tab:"a",body:"ul",itemClass:"",injectTarg:"ul",injectLoc:"bottom"},element:null,tab:null,body:null,items:[],data:{},initialize:function(b,a){this.setOptions(a);this.element=$(b);this.tab=this.element.getElement(this.options.tab);this.body=this.element.getElement(this.options.body);this.items=[]},setData:function(a,b){this.data=a;this.refresh(b)},refresh:function(c){if(!c){var b,a=this.element.getElement(this.options.injectTarg);this.data.each(function(d){this.buildItem(d,a)},this)}else{this.data.each(c)}this.element.addEvent("mouseenter",function(d){this.body.fade("in")}.bind(this));this.element.addEvent("mouseleave",function(d){this.body.fade("out")}.bind(this))},buildItem:function(c,a){var b=new Element("li",{"class":this.options.itemClass});b.appendText(c).inject(a,this.options.injectLoc);this.items.push(b)},addMouseEvents:function(b,c,a){this.items.each(function(e,d,f){if(b){e.addEvent("click",function(){b.pass([e,d,f]).call()})}if(c){e.addEvent("mouseenter",function(){c.pass([e,d,f]).call()})}if(a){e.addEvent("mouseleave",function(){a.pass([e,d,f]).call()})}})}});wknyc.common.gui.InputField=new Class({Implements:[Events,Options],options:{prefillElement:"label",wrapperName:"input-wrap"},input:null,prefill:null,initialize:function(b,a){this.setOptions(a);this.input=b;if($defined(this.options.prefillElement)&&this.options.prefillElement!=""){this.prefill=this.input.getPrevious(this.options.prefillElement).removeClass("hide")}this.addEvents();if(this.prefill){this.wrapElements();if(this.input.get("value")!=""){this.prefill.addClass("hide")}}},wrapElements:function(){var a=new Element("div").addClass(this.options.wrapperName);a.wraps(this.prefill).wraps(this.input)},addEvents:function(){this.input.addEvent("focus",function(a){if(this.input.get("value")==""&&this.prefill){if(!this.prefill.hasClass("hide")){this.prefill.addClass("hide")}}$(a.target).addClass("active");this.fireEvent("focus")}.bind(this));if(this.prefill){this.prefill.addEvent("click",function(){this.input.focus()}.bind(this))}this.input.addEvent("blur",function(a){if(this.input.get("value")==""&&this.prefill){this.prefill.removeClass("hide")}$(a.target).removeClass("active");this.fireEvent("blur")}.bind(this))}});wknyc.common.gui.MenuItem=new Class({Implements:Options,options:{selectedClass:"on",itemElement:"li",multiSelect:false,allOption:null,itemCallback:null},itemsList:null,callback:null,allItem:null,data:[],initialize:function(b,a){this.setOptions(a);this.itemsList=b;this.callback=this.options.itemCallback;if(this.options.multiSelect&&this.options.allOption){this.createAllOption()}},createAllOption:function(){this.allItem=new Element(this.options.itemElement,{html:'<a href="#">'+this.options.allOption+"</a>"}).addClass("all");this.allItem.addEvent("click",function(){if(!this.allItem.hasClass("on")){this.itemsList.getElements(this.options.itemElement).addClass("on")}else{this.itemsList.getElements(this.options.itemElement).removeClass("on")}if(this.callback){this.callback.call()}return false}.bind(this));this.itemsList.grab(this.allItem)},setData:function(a){this.data=a;this.refresh()},refresh:function(){this.data.each(function(a){this.createItem(a)}.bind(this))},createItem:function(b){var a=new Element(this.options.itemElement,{html:'<a href="#">'+b+"</a>"});a.getElement("a").addEvent("click",function(c){if(!$(c.target).getParent().hasClass("on")){if(this.allItem){this.allItem.removeClass("on")}if(!this.options.multiSelect){this.itemsList.getElements(this.options.itemElement).removeClass(this.options.selectedClass)}$(c.target).getParent().addClass(this.options.selectedClass);if(this.callback){this.callback.call()}}else{if(this.options.multiSelect){if(this.allItem){this.allItem.removeClass("on")}$(c.target).getParent().removeClass("on");if(this.callback){this.callback.call()}}}return false}.bind(this));this.itemsList.grab(a)}});wknyc.common.gui.SkinnedFileInput=new Class({Implements:Options,options:{skinnedElement:null,reuploadText:""},input:$empty,skinnedElement:$empty,filenameElement:$empty,initialize:function(b,a){this.setOptions(a);this.input=$(b);this.skinnedElement=$(this.options.skinnedElement);this.setupAssets();this.updateFilename()},setupAssets:function(){this.filenameElement=new Element("label").addClass("fileinput-filename");var a=new Element("div").addClass("fileinput-wrapper").wraps(this.input).grab(this.filenameElement).grab(this.skinnedElement);this.input.addEvent("change",this.updateFilename.bind(this));this.input.addEvent("mouseout",this.updateFilename.bind(this))},updateFilename:function(a){this.filenameElement.empty();if(this.input.value!=""){this.filenameElement.appendText(this.input.value);if(this.options.reuploadText&&this.options.reuploadText!=""){this.skinnedElement.set("html",this.options.reuploadText)}}}});wknyc.common.gui.SpinBox=new Class({Implements:Options,options:{topButton:"a.top",botButton:"a.bottom",minValue:-1,maxValue:-1,wrap:true},input:$empty,topButton:$empty,botButton:$empty,maxValue:null,minValue:null,initialize:function(b,a){this.setOptions(a);this.input=b;this.topButton=$(b).getParent().getChildren(this.options.topButton)[0];this.botButton=$(b).getParent().getChildren(this.options.botButton)[0];var c=new Element("div").addClass("spinbox-wrapper").wraps(this.input);c.grab(this.topButton,"top").grab(this.botButton);this.setMaxValue(this.options.maxValue);this.setMinValue(this.options.minValue);this.addEvents();this.modifyValue(0)},addEvents:function(){this.topButton.addEvent("click",function(a){this.modifyValue(1,this.options.wrap);return false}.bind(this));this.botButton.addEvent("click",function(a){this.modifyValue(-1,this.options.wrap);return false}.bind(this))},setMaxValue:function(a){this.maxValue=a.toInt()>=0?a.toInt():null},setMinValue:function(a){this.minValue=a.toInt()>=0?a.toInt():null},modifyValue:function(c,a){var b=this.input.get("value").toInt();if(b.toString()!="NaN"){b+=c;if($defined(this.minValue)&&$defined(this.maxValue)){if(b>this.maxValue){if(a){b=this.minValue}else{b=this.maxValue}}else{if(b<this.minValue){if(a){b=this.maxValue}else{b=this.minValue}}}}this.input.set("value",b)}else{this.input.set("value","0")}}});wknyc.common.gui.Tabs=new Class({Implements:[Options,Events],options:{duration:250,defaultTab:0,loadDefaultTab:true,useDeepLinking:false,activeClass:"active",useAjax:false,urlAttribute:"href"},tabs:null,content:null,currentIndex:-1,isFirstLoad:true,initialize:function(b,c,a){this.tabs=$(b);this.content=$(c);this.setOptions(a);this.setupAssets();this.addEvents();if(this.options.useDeepLinking){this.setupDeepLinking()}else{if(this.options.loadDefaultTab){this.loadDefaultTab()}else{return}}},setupAssets:function(){this.content.getChildren().each(function(a){a.set("styles",{display:"none",opacity:0})})},addEvents:function(){this.tabs.getChildren("li").each(function(b,a,c){b.store("index",a);b.addEvent("click",function(d){this.selectTab(b,false);return false}.bind(this))}.bind(this))},loadDefaultTab:function(){if(this.isFirstLoad){this.selectTab(this.tabs.getElements("li")[this.options.defaultTab],true);this.isFirstLoad=false}},setupDeepLinking:function(){SWFAddress.addEventListener(SWFAddressEvent.CHANGE,this.onAddressUpdated.bind(this))},onAddressUpdated:function(c){var a=$(c.path);if(a){var b=a.getParent();this.doSelectTab(b.retrieve("index"),this.isFirstLoad,b);this.isFirstLoad=false}else{if(this.isFirstLoad&&this.options.loadDefaultTab){this.loadDefaultTab()}}},selectTabByIndex:function(a,c){var b=this.tabs.getElements("li")[a];this.selectTab(b,c)},selectTab:function(a,b){if(this.options.useDeepLinking){window.location.hash="#"+a.getElement("a").get("id")}else{this.doSelectTab(a.retrieve("index"),false,a)}},doSelectTab:function(c,f,d){var b=this.content.getElement("."+this.options.activeClass);if(this.tabs.getChildren("."+this.options.activeClass)){this.tabs.getChildren("."+this.options.activeClass).removeClass(this.options.activeClass)}if(this.content.getChildren("."+this.options.activeClass)){this.content.getChildren("."+this.options.activeClass).removeClass(this.options.activeClass)}var a;if(this.tabs.getChildren().length>0){a=this.tabs.getChildren()[c].addClass(this.options.activeClass)}if(!this.options.useAjax){var e;if(this.content.getChildren().length>0){e=this.content.getChildren()[c].addClass(this.options.activeClass)}this.fireEvent("change",[c,d]);this.transitionNewContent(e,b,f)}else{this.loadAjaxContent(c,d,f)}this.currentIndex=c},transitionNewContent:function(b,a,c){if(a){a.set("styles",{display:"none",opacity:0})}if(b){if(!c){b.set("tween",{onStart:function(){b.set("styles",{display:"block"})},duration:this.options.duration,transition:new Fx.Transition(Fx.Transitions.Quad.easeOut)});b.set("opacity",0).fade("in")}else{b.set("styles",{display:"block"});b.fade("show")}}},loadAjaxContent:function(a,b,c){var d=new Request.HTML().get(b.getElement("a").get(this.options.urlAttribute));d.addEvent("success",function(g,e,h,f){this.content.empty().set({html:h,opacity:0});this.fireEvent("change",[a,b]);this.transitionNewContent(this.content,null,c)}.bind(this))}});wknyc.common.gui.SectionTabs=new Class({Extends:wknyc.common.gui.Tabs,initialize:function(b,c,a){this.parent(b,c,a)},addEvents:function(){var a;this.tabs.getChildren("li").each(function(c,b,d){c.store("index",b);c.addEvent("click",function(f){this.selectTab(c,false);return false}.bind(this));onState=c.getElement("a.univers").clone(true,true);onState.inject(c.getElement("a.univers"),"after").addClass(this.options.activeClass+" hide")}.bind(this))},selectTab:function(a,b){this.toggleState(a);this.parent(a,b)},toggleState:function(a){this.tabs.getChildren("li").each(function(b){this.showOnState(b,false)}.bind(this));this.showOnState(a,true)},showOnState:function(c,b){var a=c.getElement("a.univers:not(."+this.options.activeClass+")");var d=a.getNext("a."+this.options.activeClass);if(b){d.removeClass("hide");if(!a.hasClass("hide")){a.addClass("hide")}}else{a.removeClass("hide");if(!d.hasClass("hide")){d.addClass("hide")}}}});