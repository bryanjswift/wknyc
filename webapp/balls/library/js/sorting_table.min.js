var SortingTable=new Class({Implements:Options,options:{zebra:true,details:false,paginator:false,onSorted:$empty,dont_sort_class:"nosort",forward_sort_class:"forward_sort",reverse_sort_class:"reverse_sort",defaultSort:null},initialize:function(b,a){this.table=$(b);this.setOptions(a);this.tbody=this.table.getElement("tbody");if(this.options.zebra){SortingTable.stripe_table(this.tbody.getChildren())}this.headers=this.table.getElement("thead").getElements("th");this.headers.each(function(d,c){if(d.hasClass(this.options.dont_sort_class)){return}d.store("column",c);d.addEvent("mousedown",function(e){this.sort_by_header(e.target);if(this.options.paginator){this.options.paginator.to_page(1)}}.bind(this))},this);this.load_conversions();if(this.options.defaultSort){this.sort_by_header(this.table.getElement(this.options.defaultSort))}},sort_by_header:function(e){var d=[];var c=this.tbody.getPrevious();this.tbody.dispose();var a=this.tbody.getChildren();while(row=a.shift()){row={row:row.dispose()};if(this.options.details){row.detail=a.shift().dispose()}d.unshift(row)}if(this.sort_column>=0&&this.sort_column==e.retrieve("column")){if(e.hasClass(this.options.reverse_sort_class)){e.removeClass(this.options.reverse_sort_class);e.addClass(this.options.forward_sort_class)}else{e.removeClass(this.options.forward_sort_class);e.addClass(this.options.reverse_sort_class)}}else{this.headers.each(function(f){f.removeClass(this.options.forward_sort_class);f.removeClass(this.options.reverse_sort_class)},this);this.sort_column=e.retrieve("column");if(e.retrieve("conversion_function")){this.conversion_matcher=e.retrieve("conversion_matcher");this.conversion_function=e.retrieve("conversion_function")}else{this.conversion_function=false;d.some(function(g){var f=$(g.row.getElementsByTagName("td")[this.sort_column]).get("text");if(f==""){return false}this.conversions.some(function(h){if(h.matcher.test(f)){this.conversion_matcher=h.matcher;this.conversion_function=h.conversion_function;return true}return false},this);return !!(this.conversion_function)},this);e.store("conversion_function",this.conversion_function);e.store("conversion_matcher",this.conversion_matcher)}e.addClass(this.options.forward_sort_class);d.each(function(g){var f=this.conversion_function(g);g.toString=function(){return f}},this);d.sort()}var b=0;while(row=d.shift()){this.tbody.appendChild(row.row);if(row.detail){this.tbody.appendChild(row.detail)}if(this.options.zebra){row.row.className=row.row.className.replace(this.removeAltClassRe,"$1").clean();if(row.detail){row.detail.className=row.detail.className.replace(this.removeAltClassRe,"$1").clean()}if(b%2){row.row.addClass("alt");if(row.detail){row.detail.addClass("alt")}}}b++}this.tbody.inject(c,"after");this.options.onSorted.call()},load_conversions:function(){this.conversions=$A([{matcher:/([0-9.]{1,8}).*([KMGT]{1})B/,conversion_function:function(c){var a=$(c.row.getElementsByTagName("td")[this.sort_column]).get("text");a=this.conversion_matcher.exec(a);if(!a){return"0"}if(a[2]=="M"){sort_val="1"}else{if(a[2]=="G"){sort_val="2"}else{if(a[2]=="T"){sort_val="3"}else{sort_val="0"}}}var b=a[1].indexOf(".");if(b==-1){post="00"}else{var d=a[1].split(".");a[1]=d[0];post=d[1].concat("00".substr(0,2-d[1].length))}return sort_val.concat("00000000".substr(0,2-a[1].length).concat(a[1])).concat(post)}},{matcher:/(\d{1,2}) (.{3,6}) ago/,conversion_function:function(c){var a=$(c.row.getElementsByTagName("td")[this.sort_column]).get("text");a=this.conversion_matcher.exec(a);if(!a){return"0"}var b;if(a[2].indexOf("month")!=-1){b="1"}else{if(a[2].indexOf("year")!=-1){b="2"}else{b="0"}}return b.concat("00".substr(0,2-a[1].length).concat(a[1]))}},{matcher:/((\d{1}\.\d{2}|\d{2}\.\d{2}|\d{3}\.\d{2}|\d{4}\.\d{2}|\d{5}\.\d{2}|\d{6}\.\d{2}))/,conversion_function:function(b){var a=$(b.row.getElementsByTagName("td")[this.sort_column]).get("text");a=a.replace(/[^\d]/g,"");return"00000000000000000000000000000000".substr(0,32-a.length).concat(a)}},{matcher:/(\d{4})-(\d{1,2})-(\d{1,2})/,conversion_function:function(b){var a=$(b.row.getElementsByTagName("td")[this.sort_column]).get("text");a=this.conversion_matcher.exec(a);return a[1]+"00".substr(0,2-a[2].length).concat(a[2])+"00".substr(0,2-a[3].length).concat(a[3])}},{matcher:/^\d+$/,conversion_function:function(b){var a=$(b.row.getElementsByTagName("td")[this.sort_column]).get("text");return"00000000000000000000000000000000".substr(0,32-a.length).concat(a)}},{matcher:/.*/,conversion_function:function(a){return $(a.row.getElementsByTagName("td")[this.sort_column]).get("text")}}])}});SortingTable.removeAltClassRe=new RegExp("(^|\\s)alt(?:\\s|$)");SortingTable.implement({removeAltClassRe:SortingTable.removeAltClassRe});SortingTable.stripe_table=function(b){var a=0;b.each(function(c){if(!c.hasClass("collapsed")){a++}c.className=c.className.replace(this.removeAltClassRe,"$1").clean();if(a%2){c.addClass("alt")}})};